#!/bin/sh
# âš ï¸ CHECKLIST OBLIGATORIO ANTES DE PUSH
# Ver docs/CHECKLIST_PRE_PUSH.md para mÃ¡s detalles

echo "ğŸ§ª Ejecutando pruebas antes de push..."
echo "ğŸ“‹ Verifica que hayas actualizado las pruebas segÃºn los cambios realizados"
echo "ğŸ“š Consulta docs/CHECKLIST_PRE_PUSH.md para el checklist completo"
echo ""

# Ejecutar pruebas unitarias
echo "ğŸ“¦ Ejecutando pruebas unitarias..."
npm run test || {
  echo ""
  echo "âŒ Las pruebas unitarias fallaron. Por favor, corrige los errores antes de hacer push."
  echo "ğŸ’¡ AsegÃºrate de haber actualizado las pruebas segÃºn los cambios realizados"
  echo "ğŸ“š Consulta docs/CHECKLIST_PRE_PUSH.md para mÃ¡s informaciÃ³n"
  exit 1
}

# Ejecutar linting
echo ""
echo "ğŸ” Ejecutando linting..."
npm run lint || {
  echo ""
  echo "âŒ El linting fallÃ³. Por favor, corrige los errores antes de hacer push."
  exit 1
}

# Ejecutar pruebas e2e solo con Chromium (mÃ¡s rÃ¡pido)
# En CI se ejecutan todas las pruebas e2e automÃ¡ticamente
if [ -z "$CI" ]; then
  echo ""
  echo "ğŸŒ Ejecutando pruebas e2e (Chromium)..."
  npx playwright test --project=chromium || {
    echo ""
    echo "âŒ Las pruebas e2e fallaron. Por favor, corrige los errores antes de hacer push."
    exit 1
  }
else
  echo "â­ï¸  Saltando pruebas e2e en CI (se ejecutan en GitHub Actions)"
fi

echo ""
echo "âœ… Todas las pruebas pasaron. Procediendo con push..."
