import{c as f,r as c,s as n,j as e,U as _,M as U}from"./index-zzFyhS3F.js";import{C as x}from"./check-circle-D7FyQisT.js";import{C as E}from"./clock-Dx-ajNhx.js";/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const w=f("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const m=f("XCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]),C=({currentUser:S})=>{const[p,j]=c.useState([]),[v,d]=c.useState(!0),[u,a]=c.useState(""),[g,o]=c.useState("");c.useEffect(()=>{l()},[]);const l=async()=>{d(!0),a("");try{if(!n){a("Supabase is not configured. Check VITE_SUPABASE_URL and VITE_SUPABASE_ANON_KEY in .env"),d(!1);return}console.log("[USER ADMIN] ðŸ” Intentando cargar usuarios desde producciÃ³n..."),console.log("[USER ADMIN] 1ï¸âƒ£ Intentando tabla app_users...");let{data:s,error:t}=await n.from("app_users").select("*").order("created_at",{ascending:!1});if(console.log("[USER ADMIN] app_users Result:",{hasData:!!s,dataLength:(s==null?void 0:s.length)||0,error:t?{message:t.message,code:t.code,hint:t.hint}:null}),!t&&s)console.log("[USER ADMIN] âœ… Usando app_users!"),s=s.map(r=>{var i;return{id:r.id,email:r.email,display_name:r.display_name||r.name||((i=r.email)==null?void 0:i.split("@")[0])||"Unknown",role:r.role||"Regular",is_active:r.is_active!==void 0?r.is_active:r.status==="active",last_login_at:r.last_login_at||r.last_sign_in_at||r.updated_at,created_at:r.created_at}});else{console.log("[USER ADMIN] 2ï¸âƒ£ app_users fallÃ³, intentando RPC get_all_users...");const r=await n.rpc("get_all_users");!r.error&&r.data?(console.log("[USER ADMIN] âœ… Usando RPC!"),s=r.data,t=null):t=r.error||t}if(t){const r=t.message||"Unknown error",i=t.code||"";console.error("[USER ADMIN] âŒ Error completo:",{message:r,code:i,hint:t.hint}),a(`No se pudo cargar usuarios desde Supabase.

Error: ${i} - ${r}

Verifica que la tabla 'app_users' exista en producciÃ³n
o que la funciÃ³n RPC 'get_all_users' estÃ© disponible.`);return}console.log("[USER ADMIN] âœ… Usuarios cargados:",(s==null?void 0:s.length)||0),j(s||[])}catch(s){console.error("[USER ADMIN] âŒ Exception:",s),a("Error loading users: "+(s.message||"Unknown error"))}finally{d(!1)}},N=async s=>{a(""),o("");try{const{error:t}=await n.rpc("approve_user",{p_user_id:s});if(t){a(t.message);return}o("User approved successfully"),await l(),setTimeout(()=>o(""),3e3)}catch(t){console.error("[USER ADMIN] Error approving user:",t),a("Error approving user: "+(t.message||"Unknown error"))}},b=async s=>{if(a(""),o(""),!!confirm("Are you sure you want to deactivate this user? They will be logged out immediately."))try{const{error:t}=await n.rpc("deactivate_user",{p_user_id:s});if(t){a(t.message);return}o("User deactivated successfully"),await l(),setTimeout(()=>o(""),3e3)}catch(t){console.error("[USER ADMIN] Error deactivating user:",t),a("Error deactivating user: "+(t.message||"Unknown error"))}},y=async(s,t)=>{a(""),o("");try{const{error:r}=await n.rpc("update_user_role",{p_user_id:s,p_new_role:t});if(r){a(r.message);return}o("User role updated successfully"),await l(),setTimeout(()=>o(""),3e3)}catch(r){console.error("[USER ADMIN] Error updating role:",r),a("Error updating role: "+(r.message||"Unknown error"))}},h=s=>{if(!s)return"Never";const t=new Date(s);return t.toLocaleDateString()+" "+t.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})};return v?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-cyan-500"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(_,{className:"text-cyan-400",size:28}),e.jsx("h2",{className:"text-2xl font-bold text-slate-200",children:"User Administration"})]}),e.jsx("button",{onClick:l,className:"px-4 py-2 bg-slate-700 hover:bg-slate-600 text-slate-200 rounded-lg transition-colors",children:"Refresh"})]}),u&&e.jsxs("div",{className:"flex flex-col gap-3 p-4 bg-rose-500/10 border border-rose-500/30 rounded-lg",children:[e.jsxs("div",{className:"flex items-start gap-2 text-rose-400 text-sm",children:[e.jsx(m,{size:16,className:"mt-0.5 flex-shrink-0"}),e.jsx("div",{className:"flex-1 whitespace-pre-line",children:u})]}),e.jsx("button",{onClick:()=>{a(""),l()},className:"self-start px-4 py-2 bg-rose-500/20 hover:bg-rose-500/30 border border-rose-500/50 rounded-lg text-rose-300 text-sm transition-colors",children:"Retry"})]}),g&&e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-green-500/10 border border-green-500/30 rounded-lg text-green-400 text-sm",children:[e.jsx(x,{size:16}),e.jsx("span",{children:g})]}),e.jsx("div",{className:"glass rounded-xl border border-white/10 overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-slate-800/50 border-b border-white/10",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-slate-300",children:"User"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-slate-300",children:"Role"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-slate-300",children:"Status"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-slate-300",children:"Last Login"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-slate-300",children:"Created"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-slate-300",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-white/5",children:p.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"6",className:"px-4 py-8 text-center text-slate-400",children:"No users found"})}):p.map(s=>e.jsxs("tr",{className:"hover:bg-slate-800/30 transition-colors",children:[e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(w,{size:16,className:"text-slate-400"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-slate-200 font-medium",children:s.display_name}),e.jsxs("div",{className:"text-slate-400 text-xs flex items-center gap-1",children:[e.jsx(U,{size:12}),s.email]})]})]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("select",{value:s.role,onChange:t=>y(s.id,t.target.value),className:"px-2 py-1 bg-slate-700 border border-white/10 rounded text-slate-200 text-sm focus:outline-none focus:border-cyan-500/50",children:[e.jsx("option",{value:"Regular",children:"Regular"}),e.jsx("option",{value:"PM",children:"PM"}),e.jsx("option",{value:"Stakeholder",children:"Stakeholder"}),e.jsx("option",{value:"3amigos",children:"3amigos"}),e.jsx("option",{value:"admin",children:"admin"})]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:`inline-flex items-center gap-1 px-2 py-1 rounded text-xs font-medium ${s.is_active?"bg-green-500/10 text-green-400 border border-green-500/30":"bg-rose-500/10 text-rose-400 border border-rose-500/30"}`,children:s.is_active?e.jsxs(e.Fragment,{children:[e.jsx(x,{size:12}),"Active"]}):e.jsxs(e.Fragment,{children:[e.jsx(m,{size:12}),"Pending Approval"]})})}),e.jsx("td",{className:"px-4 py-3 text-slate-400 text-sm",children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(E,{size:12}),h(s.last_login_at)]})}),e.jsx("td",{className:"px-4 py-3 text-slate-400 text-sm",children:h(s.created_at)}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("div",{className:"flex items-center gap-2",children:s.is_active?e.jsxs("button",{onClick:()=>b(s.id),className:"px-3 py-1 bg-rose-500/10 hover:bg-rose-500/20 text-rose-400 border border-rose-500/30 rounded text-sm transition-colors flex items-center gap-1",children:[e.jsx(m,{size:14}),"Deactivate"]}):e.jsxs("button",{onClick:()=>N(s.id),className:"px-3 py-1 bg-green-500/10 hover:bg-green-500/20 text-green-400 border border-green-500/30 rounded text-sm transition-colors flex items-center gap-1",children:[e.jsx(x,{size:14}),"Approve"]})})})]},s.id))})]})})})]})};export{C as default};
