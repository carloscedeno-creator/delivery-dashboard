import{c as L,r,R as U,j as e,a as G,C as D}from"./index-zzFyhS3F.js";import{a as W,b as X,c as Y,d as H,g as J}from"./developerMetricsApi-BDZsV7mU.js";import{R as h,C as v,T as A,L as Q,B as Z,X as ee,Y as se,a as te}from"./BarChart-BMm4yCV-.js";import{P as w,a as C}from"./PieChart-CtblTHAS.js";import{C as ae}from"./CartesianGrid-D4_rAjME.js";import{C as le}from"./check-circle-2-Clqhd3yE.js";/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const re=L("Circle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ne=L("Star",[["polygon",{points:"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2",key:"8f66p6"}]]),ue=()=>{var _,k,$;console.log("ðŸ”µ [DeveloperMetrics] Componente renderizado");const[u,z]=r.useState([]),[x,f]=r.useState([]),[j,g]=r.useState([]),[l,E]=r.useState(null),[i,p]=r.useState(null),[n,m]=r.useState(null),[a,b]=r.useState(null),[N,c]=r.useState(!0),[y,K]=r.useState(null),[M,d]=r.useState(null);r.useEffect(()=>{(async()=>{try{d(null),c(!0),console.log("ðŸŸ¢ [DeveloperMetrics] Cargando squads...");const t=await W();console.log("ðŸŸ¢ [DeveloperMetrics] Squads cargados:",t),z(t),t.length>0?(E(t[0].id),console.log("ðŸŸ¢ [DeveloperMetrics] Squad seleccionado:",t[0].id,t[0].squad_name)):d("No se encontraron squads. Verifica que Supabase estÃ© configurado correctamente.")}catch(t){console.error("ðŸ”´ [DeveloperMetrics] Error cargando squads:",t),d(`Error cargando squads: ${t.message}. Verifica que Supabase estÃ© configurado correctamente.`)}finally{c(!1)}})()},[]),r.useEffect(()=>{if(!l){f([]),p(null);return}(async()=>{try{console.log("ðŸŸ¢ [DeveloperMetrics] Cargando sprints para squad:",l);const t=await X(l);console.log("ðŸŸ¢ [DeveloperMetrics] Sprints cargados:",t),f(t);const o=t.find(S=>S.is_active);o?(p(o.id),console.log("ðŸŸ¢ [DeveloperMetrics] Sprint actual seleccionado:",o.id,o.sprint_name)):t.length>0&&(p(t[0].id),console.log("ðŸŸ¢ [DeveloperMetrics] Primer sprint seleccionado:",t[0].id,t[0].sprint_name))}catch(t){console.error("ðŸ”´ [DeveloperMetrics] Error cargando sprints:",t),f([])}})()},[l]),r.useEffect(()=>{if(!l){g([]),m(null);return}(async()=>{try{d(null),console.log("ðŸŸ¢ [DeveloperMetrics] Cargando developers para squad:",l);const t=await Y(l);console.log("ðŸŸ¢ [DeveloperMetrics] Developers cargados:",t),g(t),t.length>0&&!n?(m(t[0].id),console.log("ðŸŸ¢ [DeveloperMetrics] Developer seleccionado:",t[0].id,t[0].display_name)):t.length===0&&d("No se encontraron desarrolladores para este squad."),c(!1)}catch(t){console.error("ðŸ”´ [DeveloperMetrics] Error cargando developers:",t),g([]),d(`Error cargando desarrolladores: ${t.message}`),c(!1)}})()},[l]),r.useEffect(()=>{if(!n){b(null),c(!1);return}(async()=>{try{c(!0),console.log("ðŸŸ¢ [DeveloperMetrics] Cargando mÃ©tricas para developer:",n,"squad:",l,"sprint:",i);const t=await H(n);console.log("ðŸŸ¢ [DeveloperMetrics] Developer info:",t),K(t);const o=await J(n,l,i);console.log("ðŸŸ¢ [DeveloperMetrics] MÃ©tricas cargadas:",o),b(o)}catch(t){console.error("ðŸ”´ [DeveloperMetrics] Error cargando mÃ©tricas:",t),b(null),d(`Error cargando mÃ©tricas: ${t.message}`)}finally{c(!1)}})()},[n,l,i]);const V=((_=u.find(s=>s.id===l))==null?void 0:_.squad_name)||"Global";(k=x.find(s=>s.id===i))!=null&&k.sprint_name;const B=(($=x.find(s=>s.id===i))==null?void 0:$.is_active)||!1,P=(y==null?void 0:y.display_name)||"",q=U.useMemo(()=>{if(!(a!=null&&a.statusBreakdown))return[];const s=["#3b82f6","#10b981","#f59e0b","#ef4444","#8b5cf6","#ec4899","#06b6d4","#84cc16","#f97316","#6366f1"];return Object.entries(a.statusBreakdown).map(([t,o],S)=>({name:t,value:o.count,percentage:o.percentage,color:s[S%s.length]}))},[a]),T=U.useMemo(()=>a?[{name:"With SP",value:a.metrics.withSP,color:"#3b82f6"},{name:"No SP",value:a.metrics.noSP,color:"#8b5cf6"}]:[],[a]),F=(a==null?void 0:a.metrics.devDoneRate)||0,I=(a==null?void 0:a.metrics.spDevDoneRate)||0,R=[{name:"Done",value:(a==null?void 0:a.metrics.devDone)||0,color:"#10b981"},{name:"Remaining",value:((a==null?void 0:a.metrics.totalTickets)||0)-((a==null?void 0:a.metrics.devDone)||0),color:"#1e293b"}],O=[{name:"Done",value:(a==null?void 0:a.metrics.devDoneSP)||0,color:"#10b981"},{name:"Remaining",value:((a==null?void 0:a.metrics.totalSPAssigned)||0)-((a==null?void 0:a.metrics.devDoneSP)||0),color:"#1e293b"}];return console.log("ðŸŸ¡ [DeveloperMetrics] Estado actual:",{loading:N,hasMetricsData:!!a,selectedSquad:l,selectedSprint:i,selectedDeveloper:n,squadsCount:u.length,sprintsCount:x.length,developersCount:j.length}),N&&u.length===0?e.jsx("div",{className:"space-y-6",children:e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-cyan-500"})})}):M&&!N?e.jsx("div",{className:"space-y-6",children:e.jsx("div",{className:"glass rounded-2xl p-6 border border-rose-500/50",children:e.jsxs("div",{className:"flex items-center gap-3 text-rose-400",children:[e.jsx(G,{size:24}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Error cargando mÃ©tricas"}),e.jsx("p",{className:"text-sm text-slate-400 mt-1",children:M})]})]})})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-wrap gap-4 items-center",children:[e.jsxs("div",{className:"relative group",children:[e.jsxs("select",{className:"appearance-none bg-slate-800/50 border border-white/10 rounded-xl px-4 py-2 pr-10 text-slate-300 focus:outline-none focus:border-cyan-500/50 transition-colors cursor-pointer min-w-[180px]",value:l||"",onChange:s=>{E(s.target.value||null),p(null),m(null)},children:[e.jsx("option",{value:"",children:"Global"}),u.map(s=>e.jsx("option",{value:s.id,children:s.squad_name},s.id))]}),e.jsx(D,{className:"absolute right-3 top-1/2 -translate-y-1/2 text-slate-500 pointer-events-none",size:16})]}),e.jsxs("div",{className:"relative group",children:[e.jsxs("select",{className:"appearance-none bg-slate-800/50 border border-white/10 rounded-xl px-4 py-2 pr-10 text-slate-300 focus:outline-none focus:border-cyan-500/50 transition-colors cursor-pointer min-w-[200px]",value:i||"",onChange:s=>{p(s.target.value||null)},disabled:!l||x.length===0,children:[e.jsx("option",{value:"",children:"All Sprints"}),x.map(s=>e.jsxs("option",{value:s.id,children:[s.sprint_name," ",s.is_active?"(Current)":""]},s.id))]}),B&&e.jsx(ne,{className:"absolute right-8 top-1/2 -translate-y-1/2 text-yellow-400 fill-yellow-400",size:14}),e.jsx(D,{className:"absolute right-3 top-1/2 -translate-y-1/2 text-slate-500 pointer-events-none",size:16})]}),e.jsxs("div",{className:"relative group",children:[e.jsxs("select",{className:"appearance-none bg-slate-800/50 border border-white/10 rounded-xl px-4 py-2 pr-10 text-slate-300 focus:outline-none focus:border-cyan-500/50 transition-colors cursor-pointer min-w-[200px]",value:n||"",onChange:s=>{m(s.target.value||null)},disabled:!l||j.length===0,children:[e.jsx("option",{value:"",children:"Select Developer"}),j.map(s=>e.jsx("option",{value:s.id,children:s.display_name},s.id))]}),e.jsx(D,{className:"absolute right-3 top-1/2 -translate-y-1/2 text-slate-500 pointer-events-none",size:16})]})]}),n&&e.jsx("div",{children:e.jsxs("h2",{className:"text-2xl font-semibold text-white",children:["Metrics for ",V,P&&` - ${P}`]})}),n?!a||a.metrics.totalTickets===0?e.jsx("div",{className:"text-center text-slate-400 py-12",children:"No tickets found for the selected filters"}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"glass rounded-2xl p-6",children:[e.jsx("h3",{className:"text-sm font-medium text-slate-400 mb-4",children:"Dev Done Rate"}),e.jsxs("div",{className:"relative h-[200px] flex items-center justify-center",children:[e.jsx(h,{width:"100%",height:"100%",children:e.jsx(w,{children:e.jsx(C,{data:R,cx:"50%",cy:"50%",innerRadius:60,outerRadius:80,startAngle:90,endAngle:-270,dataKey:"value",stroke:"none",children:R.map((s,t)=>e.jsx(v,{fill:s.color},`cell-${t}`))})})}),e.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center pointer-events-none",children:[e.jsxs("div",{className:"text-3xl font-bold text-white",children:[F.toFixed(1),"%"]}),e.jsxs("div",{className:"text-sm text-slate-400 mt-1",children:["Dev Done: ",a.metrics.devDone,"/",a.metrics.totalTickets]})]})]})]}),e.jsxs("div",{className:"glass rounded-2xl p-6",children:[e.jsx("h3",{className:"text-sm font-medium text-slate-400 mb-4",children:"SP Dev Done"}),e.jsxs("div",{className:"relative h-[200px] flex items-center justify-center",children:[e.jsx(h,{width:"100%",height:"100%",children:e.jsx(w,{children:e.jsx(C,{data:O,cx:"50%",cy:"50%",innerRadius:60,outerRadius:80,startAngle:90,endAngle:-270,dataKey:"value",stroke:"none",children:O.map((s,t)=>e.jsx(v,{fill:s.color},`cell-${t}`))})})}),e.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center pointer-events-none",children:[e.jsxs("div",{className:"text-3xl font-bold text-white",children:[I.toFixed(1),"%"]}),e.jsxs("div",{className:"text-sm text-slate-400 mt-1",children:["Dev Done SP: ",a.metrics.devDoneSP,"/",a.metrics.totalSPAssigned]})]})]})]}),e.jsxs("div",{className:"glass rounded-2xl p-6",children:[e.jsx("h3",{className:"text-sm font-medium text-slate-400 mb-4",children:"Key Metrics"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-slate-400",children:"Total Tickets:"}),e.jsx("span",{className:"text-white font-semibold",children:a.metrics.totalTickets})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-slate-400",children:"With SP:"}),e.jsx("span",{className:"text-white font-semibold",children:a.metrics.withSP})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-slate-400",children:"No SP:"}),e.jsx("span",{className:"text-white font-semibold",children:a.metrics.noSP})]}),e.jsxs("div",{className:"flex justify-between items-center pt-2 border-t border-white/10",children:[e.jsx("span",{className:"text-slate-400",children:"Total SP:"}),e.jsx("span",{className:"text-white font-semibold",children:a.metrics.totalSP})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"glass rounded-2xl p-6",children:[e.jsx("h3",{className:"text-xl font-semibold text-white mb-6",children:"Tickets by Status"}),e.jsx(h,{width:"100%",height:300,children:e.jsxs(w,{children:[e.jsx(C,{data:q,cx:"50%",cy:"50%",labelLine:!1,label:({value:s,percentage:t})=>`${s}: ${t}%`,outerRadius:100,fill:"#8884d8",dataKey:"value",children:q.map((s,t)=>e.jsx(v,{fill:s.color||`hsl(${t*60}, 70%, 50%)`},`cell-${t}`))}),e.jsx(A,{contentStyle:{backgroundColor:"#1e293b",border:"1px solid #374151",borderRadius:"8px"}}),e.jsx(Q,{wrapperStyle:{paddingTop:"20px"},iconType:"circle",formatter:(s,t)=>e.jsxs("span",{style:{color:"#e2e8f0",fontSize:"12px"},children:[s,": ",t.payload.value," (",t.payload.percentage,"%)"]})})]})})]}),e.jsxs("div",{className:"glass rounded-2xl p-6",children:[e.jsx("h3",{className:"text-xl font-semibold text-white mb-6",children:"Tickets: SP vs No SP"}),e.jsx(h,{width:"100%",height:300,children:e.jsxs(Z,{data:T,children:[e.jsx(ae,{strokeDasharray:"3 3",stroke:"#374151"}),e.jsx(ee,{dataKey:"name",stroke:"#9ca3af"}),e.jsx(se,{stroke:"#9ca3af"}),e.jsx(A,{contentStyle:{backgroundColor:"#1e293b",border:"1px solid #374151",borderRadius:"8px"}}),e.jsx(te,{dataKey:"value",name:"Tickets",children:T.map((s,t)=>e.jsx(v,{fill:s.color},`cell-${t}`))})]})})]})]}),(a==null?void 0:a.tickets)&&a.tickets.length>0&&e.jsxs("div",{className:"glass rounded-2xl p-6",children:[e.jsxs("h3",{className:"text-xl font-semibold text-white mb-6",children:["Tickets Trabajados en el Sprint (",a.tickets.length,")"]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-white/10",children:[e.jsx("th",{className:"text-left py-3 px-4 text-slate-400 font-medium",children:"Key"}),e.jsx("th",{className:"text-left py-3 px-4 text-slate-400 font-medium",children:"Summary"}),e.jsx("th",{className:"text-left py-3 px-4 text-slate-400 font-medium",children:"Status"}),e.jsx("th",{className:"text-left py-3 px-4 text-slate-400 font-medium",children:"Story Points"}),e.jsx("th",{className:"text-left py-3 px-4 text-slate-400 font-medium",children:"Squad"})]})}),e.jsx("tbody",{children:a.tickets.map(s=>{const t=s.status&&(s.status.toUpperCase()==="DONE"||s.status.toUpperCase()==="DEVELOPMENT DONE"||s.status.toUpperCase().includes("DEVELOPMENT DONE")||s.status.toUpperCase().includes("DEV DONE")||s.status.toUpperCase().includes("DONE")&&!s.status.toUpperCase().includes("TO DO")&&!s.status.toUpperCase().includes("TODO")||s.status.toUpperCase()==="CLOSED"||s.status.toUpperCase()==="RESOLVED"||s.status.toUpperCase()==="COMPLETED");return e.jsxs("tr",{className:"border-b border-white/5 hover:bg-white/5 transition-colors",children:[e.jsx("td",{className:"py-3 px-4 text-cyan-400 font-mono text-sm",children:s.key}),e.jsx("td",{className:"py-3 px-4 text-slate-300",children:s.summary}),e.jsx("td",{className:"py-3 px-4",children:e.jsxs("span",{className:`inline-flex items-center gap-2 px-2 py-1 rounded-lg text-xs font-medium ${t?"bg-green-500/20 text-green-400 border border-green-500/30":"bg-slate-700/50 text-slate-300 border border-slate-600/30"}`,children:[t?e.jsx(le,{size:12}):e.jsx(re,{size:12}),s.status||"Unknown"]})}),e.jsx("td",{className:"py-3 px-4",children:s.hasSP?e.jsx("span",{className:"text-white font-semibold",children:s.storyPoints}):e.jsx("span",{className:"text-slate-500",children:"-"})}),e.jsx("td",{className:"py-3 px-4 text-slate-400 text-sm",children:s.squad})]},s.id)})})]})})]})]}):e.jsx("div",{className:"text-center text-slate-400 py-12",children:"Please select a Squad and Developer to view metrics"})]})};export{ue as default};
